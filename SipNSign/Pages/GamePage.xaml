<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="com.kizwiz.sipnsign.Pages.GamePage"
             Title="SipNSign">

    <Grid RowDefinitions="Auto,*,Auto">
        <!-- Header with Progress and Score -->
        <Grid Grid.Row="0" Padding="20,10" ColumnDefinitions="*,Auto">
            <ProgressBar x:Name="GameProgress" 
                Progress="{Binding ProgressPercentage}"
                ProgressColor="{DynamicResource Primary}"
                HeightRequest="10"/>

            <Frame Grid.Column="1" Padding="15,5" CornerRadius="20" BackgroundColor="{DynamicResource Primary}">
                <Label x:Name="ScoreLabel" 
               Text="{Binding CurrentScore, StringFormat='Score: {0}'}"
               TextColor="White"
               FontSize="18"
               FontAttributes="Bold"/>
            </Frame>
        </Grid>

        <!-- Main Content -->
        <Grid Grid.Row="1" Padding="20" RowSpacing="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Sign Video -->
            <Frame Grid.Row="1" 
                   Padding="10" 
                   CornerRadius="15" 
                   HasShadow="True"
                   BorderColor="{DynamicResource Primary}"
                   BackgroundColor="White">
                <toolkit:MediaElement
                    x:Name="SignVideo" 
                    Source="{Binding CurrentSign.VideoPath}"
                    Aspect="AspectFit"
                    HeightRequest="300"
                    HorizontalOptions="Center"
                    ShouldAutoPlay="True"
                    ShouldLoopPlayback="True"/>
            </Frame>

            <!-- Answer Section -->
            <VerticalStackLayout Grid.Row="2" Spacing="15">
                <Label Text="What does this sign mean?"
                       FontSize="20"
                       HorizontalOptions="Center"
                       Margin="0,0,0,10"/>

                <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" RowSpacing="15" ColumnSpacing="15">
                    <Button x:Name="AnswerButton1"
                            Grid.Column="0" Grid.Row="0"
                            Text="{Binding CurrentSign.Choices[0]}"
                            Command="{Binding AnswerCommand}"
                            CommandParameter="{Binding CurrentSign.Choices[0]}"
                            Style="{StaticResource AnswerButtonStyle}"
                            BackgroundColor="{Binding Button1Color}"
                            TextColor="White"/>

                    <Button x:Name="AnswerButton2"
                            Grid.Column="1" Grid.Row="0"
                            Text="{Binding CurrentSign.Choices[1]}"
                            Command="{Binding AnswerCommand}"
                            CommandParameter="{Binding CurrentSign.Choices[1]}"
                            Style="{StaticResource AnswerButtonStyle}"
                            BackgroundColor="{Binding Button2Color}"
                            TextColor="White"/>

                    <Button x:Name="AnswerButton3"
                            Grid.Column="0" Grid.Row="1"
                            Text="{Binding CurrentSign.Choices[2]}"
                            Command="{Binding AnswerCommand}"
                            CommandParameter="{Binding CurrentSign.Choices[2]}"
                            Style="{StaticResource AnswerButtonStyle}"
                            BackgroundColor="{Binding Button3Color}"
                            TextColor="White"/>
                </Grid>
            </VerticalStackLayout>
        </Grid>

        <!-- Feedback Section -->
        <Grid Grid.Row="2" 
              BackgroundColor="{Binding FeedbackBackgroundColor}"
              IsVisible="{Binding IsFeedbackVisible}">
            <Label x:Name="FeedbackLabel"
                   Text="{Binding FeedbackText}"
                   TextColor="White"
                   FontSize="18"
                   FontAttributes="Bold"
                   HorizontalOptions="Center"
                   VerticalOptions="Center"/>
        </Grid>

        <!-- Game Over Section -->
        <Grid x:Name="GameOverSection"
              Grid.RowSpan="3" 
              BackgroundColor="#80000000"
              IsVisible="{Binding IsGameOver}">
            <Frame CornerRadius="20" 
                   Margin="20"
                   BackgroundColor="White"
                   HasShadow="True">
                <VerticalStackLayout Spacing="20">
                    <Label Text="Game Over!"
                           FontSize="32"
                           FontAttributes="Bold"
                           HorizontalOptions="Center"/>

                    <Label Text="{Binding FinalScore, StringFormat='Final Score: {0}'}"
                           FontSize="24"
                           HorizontalOptions="Center"/>

                    <Button Text="Play Again"
                            Command="{Binding PlayAgainCommand}"
                            Style="{StaticResource PrimaryButton}"/>
                </VerticalStackLayout>
            </Frame>
        </Grid>
    </Grid>
</ContentPage>